<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Recommendations</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #0f0f0f;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    header {
      background: #121212;
      padding: 20px;
      text-align: center;
      border-bottom: 2px solid #00ffcc;
      position: relative;
    }
    header h1 { margin: 0; color: #00ffcc; }
    .toggle-theme {
      position: absolute;
      right: 20px;
      top: 20px;
      background: #00ffcc;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    .container {
      max-width: 1100px;
      margin: auto;
      padding: 20px;
    }
    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    input, select, button {
      padding: 10px;
      border-radius: 5px;
      border: none;
      background: #1a1a1a;
      color: #fff;
      flex: 1;
    }
    .glow-btn {
      background: #00ffcc;
      color: #0f0f0f;
      font-weight: bold;
      box-shadow: 0 0 10px #00ffcc;
      cursor: pointer;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }
    .card {
      background: #1c1c1c;
      border: 1px solid #00ffcc;
      padding: 20px;
      border-radius: 10px;
      position: relative;
      transition: transform 0.3s;
    }
    .card:hover {
      transform: scale(1.03);
    }
    .trend-up { color: #00ff99; }
    .trend-down { color: #ff6666; }
    .stars { color: gold; margin-top: 10px; }
    .confidence {
      height: 8px;
      border-radius: 20px;
      background: #555;
      overflow: hidden;
      margin-top: 10px;
    }
    .confidence-bar {
      height: 100%;
      background: #00ffcc;
    }
    .ai-buttons {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
    .ai-buttons button {
      flex: 1;
      background: #292929;
      color: #00ffcc;
      border: 1px solid #00ffcc;
      padding: 6px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 12px;
    }
    .ai-reason {
      font-size: 0.9em;
      margin-top: 10px;
      color: #aaa;
    }
    footer {
      text-align: center;
      padding: 10px;
      background: #121212;
      color: #ccc;
      margin-top: 40px;
    }
    body.light {
      background: #fff;
      color: #000;
    }
    body.light .card {
      background: #f4f4f4;
      border-color: #00aa88;
    }
    body.light header {
      background: #e0f7f4;
      color: #0a0a0a;
    }
    body.light input, body.light select {
      background: #fff;
      color: #000;
    }
    body.light .glow-btn {
      background: #00aa88;
      color: #fff;
    }
  </style>
</head>
<body>
  <header>
    <h1>üìä AI Stock Recommendations</h1>
    <button class="toggle-theme" onclick="toggleTheme()">üåô Theme</button>
  </header>

  <div class="container">
    <!-- Filters -->
    <div class="filters">
      <input type="text" id="searchInput" placeholder="Search company or tags..." />
      <select id="category">
        <option value="all">All</option>
        <option value="growth">Growth</option>
        <option value="value">Value</option>
      </select>
      <button class="glow-btn" onclick="downloadJSON()">‚¨áÔ∏è Download JSON</button>
    </div>

    <!-- Cards -->
    <div id="cards" class="grid"></div>

    <!-- Divider -->
    <hr style="margin:40px 0; border-color:#333;" />

    <!-- Real-time AI Insight -->
    <h2 style="text-align:center;">üîç Custom Stock Insight</h2>
    <div style="display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-top:20px;">
      <input type="text" id="customSymbol" placeholder="Enter Stock Symbol (e.g., INFY)" style="flex:1; padding:10px; max-width:300px; border-radius:5px; background:#1a1a1a; color:white; border:none;" />
      <button onclick="fetchCustomAI()" style="padding:10px 16px; background:#00ffcc; color:#000; font-weight:bold; border:none; border-radius:5px; cursor:pointer;">üß† Get Insight</button>
    </div>
    <div id="customResult" style="margin-top:20px; background:#1c1c1c; padding:20px; border-left:5px solid #00ffcc; display:none;"></div>
  </div>

  <footer>
    &copy; 2025 MarkTrade AI Engine ‚Ä¢ Realtime Recommendations
  </footer>

  <script>
    const API_KEY = "AIzaSyDS0HOFv3TOfTFTivw1NdDy2-SZsyfIZC0"; // <-- Replace with your actual Gemini API Key
    const data = [
      { symbol: "AAPL", trend: "up", stars: 5, category: "growth", confidence: 85, note: "AI expansion and services boost" },
      { symbol: "NVDA", trend: "up", stars: 4, category: "growth", confidence: 92, note: "AI chips dominate industry" },
      { symbol: "WMT", trend: "down", stars: 3, category: "value", confidence: 60, note: "Steady earnings, but flat demand" },
      { symbol: "TSLA", trend: "up", stars: 4, category: "growth", confidence: 78, note: "EV delivery rebound" }
    ];

    function render() {
      const keyword = document.getElementById('searchInput').value.toLowerCase();
      const category = document.getElementById('category').value;
      const cards = document.getElementById('cards');
      cards.innerHTML = "";

      const filtered = data.filter(item =>
        (category === "all" || item.category === category) &&
        (item.symbol.toLowerCase().includes(keyword) || item.note.toLowerCase().includes(keyword))
      );

      filtered.forEach(item => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <h2>${item.symbol}</h2>
          <p class="${item.trend === 'up' ? 'trend-up' : 'trend-down'}">Trend: ${item.trend.toUpperCase()}</p>
          <div class="stars">‚≠êÔ∏è ${item.stars} / 5</div>
          <div class="confidence"><div class="confidence-bar" style="width:${item.confidence}%"></div></div>
          <p style="margin-top: 10px; font-size: 0.95em;">${item.note}</p>
          <div class="ai-buttons">
            <button onclick="getReason('${item.symbol}')">üì• Explain</button>
            <button onclick="exportCard('${item.symbol}', ${item.confidence})">üì§ Export</button>
          </div>
          <div class="ai-reason" id="reason-${item.symbol}"></div>
        `;
        cards.appendChild(div);
      });
    }

    async function getReason(symbol) {
      const div = document.getElementById(`reason-${symbol}`);
      div.innerHTML = "‚è≥ Getting AI explanation...";
      const prompt = `Give a short and clear investment insight for ${symbol}. Mention recent trend, news, and whether to Buy, Hold, or Sell.`;

      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{ role: "user", parts: [{ text: prompt }] }]
          })
        });
        const result = await response.json();
        const reply = result?.candidates?.[0]?.content?.parts?.[0]?.text || "No data.";
        div.innerHTML = "üí¨ " + reply;
      } catch {
        div.innerHTML = "‚ö†Ô∏è Error fetching AI response.";
      }
    }

    async function fetchCustomAI() {
      const symbol = document.getElementById("customSymbol").value.trim().toUpperCase();
      const result = document.getElementById("customResult");
      if (!symbol) {
        result.style.display = "block";
        result.innerHTML = "‚ö†Ô∏è Please enter a stock symbol.";
        return;
      }

      result.style.display = "block";
      result.innerHTML = "‚è≥ Fetching AI insight...";
      const prompt = `Give a concise financial recommendation for ${symbol} with short reason. Conclude with Buy/Hold/Sell.`;

      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{ role: "user", parts: [{ text: prompt }] }]
          })
        });
        const resultJSON = await response.json();
        const reply = resultJSON?.candidates?.[0]?.content?.parts?.[0]?.text || "No data.";
        result.innerHTML = `üîç <strong>${symbol}:</strong><br>${reply}`;
      } catch {
        result.innerHTML = "‚ö†Ô∏è Failed to get recommendation.";
      }
    }

    function toggleTheme() {
      document.body.classList.toggle('light');
    }

    function exportCard(symbol, confidence) {
      const rec = data.find(d => d.symbol === symbol);
      const blob = new Blob([JSON.stringify(rec, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `${symbol}_ai_recommendation.json`;
      a.click();
    }

    function downloadJSON() {
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'recommendations.json';
      a.click();
    }

    document.getElementById('searchInput').addEventListener('input', render);
    document.getElementById('category').addEventListener('change', render);
    window.onload = render;
  </script>
</body>
</html>
